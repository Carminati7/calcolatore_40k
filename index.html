<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcolatore 40k</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- Use absolute manifest URL so browsers fetch the correct manifest on GitHub Pages -->
    <link rel="manifest" href="/calcolatore_40k/manifest.webmanifest">
    <meta name="theme-color" content="#222222">
    <link rel="icon" type="image/x-ico" sizes="192x192" href="assets/img/favicon.ico">
</head>

<body>
    <header>
        <nav class="main-nav">
            <a href="index.html" class="active">Calcolatore</a>
            <a href="docs.html">Documentazione</a>
        </nav>
        <h1>Calcolatore 40k</h1>
    </header>
    <main>
        <div class="card-3col">
            <section class="col col-unit">
                <h2>La tua unità</h2>
                <form id="calcolatore-form">
                    <div class="form-group">
                        <label for="attacchi">Numero di attacchi</label>
                        <input type="number" id="attacchi" name="attacchi" min="1" max="999" required>
                    </div>
                    <div class="form-group">
                        <label for="balistic">Balistic skill (es: 3 per 3+)</label>
                        <input type="number" id="balistic" name="balistic" min="2" max="6" required>
                    </div>
                    <div class="form-group" style="margin-top:-0.7rem;">
                        <div class="checkbox-row">
                            <input type="checkbox" id="rerollFail" name="rerollFail" class="styled-checkbox">
                            <label for="rerollFail" class="styled-checkbox-label">Permetti reroll di tutti i tiri falliti</label>
                        </div>
                        <div class="checkbox-row">
                            <input type="checkbox" id="reroll1" name="reroll1" class="styled-checkbox">
                            <label for="reroll1" class="styled-checkbox-label">Permetti reroll dei risultati 1</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="forza">Forza</label>
                        <input type="number" id="forza" name="forza" min="1" max="999" required>
                    </div>
                    <div class="form-group">
                        <label for="penetrazione">Penetrazione armatura (AP)</label>
                        <input type="number" id="penetrazione" name="penetrazione" min="0" max="999" required>
                    </div>
                    <div class="form-group">
                        <label for="danni">Danni <span style="font-weight:normal;font-size:0.9em">(es: 2, 1-3, 1,2,3, D3)</span></label>
                        <input type="text" id="danni" name="danni" pattern="([0-9]+|[dD][0-9]+)([\-,+][0-9]+|[\-,+][dD][0-9]+|,[0-9]+|,[dD][0-9]+)*" maxlength="20" required placeholder="2, 1-3, D3, D6+2, 2+D3">
                    </div>
                </form>
            </section>
            <div class="divider"></div>
            <section class="col col-target">
                <h2>Bersaglio</h2>
                <div class="form-group">
                    <label for="resistenza">Resistenza avversario</label>
                    <input type="number" id="resistenza" name="resistenza" min="1" max="999" form="calcolatore-form" required>
                </div>
                <div class="form-group">
                    <label for="salvezza">Salvezza avversaria (es: 3 per 3+)</label>
                    <input type="number" id="salvezza" name="salvezza" min="2" max="7" form="calcolatore-form" required>
                </div>
                <div class="form-group">
                    <label for="ferite">Ferite del bersaglio</label>
                    <input type="number" id="ferite" name="ferite" min="1" max="999" form="calcolatore-form" required>
                </div>
                <div class="form-group">
                    <label for="modelli">Numero di modelli nell'unità</label>
                    <input type="number" id="modelli" name="modelli" min="1" max="999" form="calcolatore-form" required>
                </div>
            </section>
            <div class="divider"></div>
            <section class="col col-result">
                <h2>Risultato</h2>
                <button type="submit" form="calcolatore-form">Calcola</button>
                <section id="risultato" aria-live="polite"></section>
            </section>
        </div>
    </main>
        <script src="assets/app.js"></script>
        <script>
            // Mutua esclusione tra le due checkbox reroll
            document.addEventListener('DOMContentLoaded', function() {
                var reroll1 = document.getElementById('reroll1');
                var rerollFail = document.getElementById('rerollFail');
                reroll1.addEventListener('change', function() {
                    if (reroll1.checked) rerollFail.checked = false;
                });
                rerollFail.addEventListener('change', function() {
                    if (rerollFail.checked) reroll1.checked = false;
                });
            });
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                    // Register service worker with absolute path so the SW scope matches manifest scope on GitHub Pages
                    var swPath = '/calcolatore_40k/service-worker.js';
                    navigator.serviceWorker.register(swPath).catch(function(err){
                        console.warn('SW registration failed:', err);
                    });
                });
            }
        </script>
</body>

</html>